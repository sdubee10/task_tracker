<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>신청서 관계 그래프 - TaskFlow</title>
    <link rel="icon" href="data:,">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/base.css">
    <link rel="stylesheet" href="css/components.css">
    <link rel="stylesheet" href="css/request-graph.css">
</head>
<body class="graph-page">
    <div class="graph-app">
        <!-- 헤더 -->
        <header class="graph-header">
            <div class="header-left">
                <div class="logo-icon">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="3"/>
                        <circle cx="19" cy="5" r="2"/>
                        <circle cx="5" cy="5" r="2"/>
                        <circle cx="19" cy="19" r="2"/>
                        <circle cx="5" cy="19" r="2"/>
                        <line x1="12" y1="9" x2="12" y2="5"/>
                        <line x1="14.5" y1="13.5" x2="17.5" y2="17"/>
                        <line x1="9.5" y1="13.5" x2="6.5" y2="17"/>
                    </svg>
                </div>
                <div class="header-title">
                    <h1>신청서 관계 그래프</h1>
                    <p>부서별 담당자와 신청서 처리 현황</p>
                </div>
            </div>
            <div class="header-actions">
                <!-- 테마 선택기 -->
                <div class="theme-selector">
                    <button class="btn-icon theme-toggle" onclick="toggleThemeDropdown()" title="테마 변경">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="5"/>
                            <line x1="12" y1="1" x2="12" y2="3"/>
                            <line x1="12" y1="21" x2="12" y2="23"/>
                            <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/>
                            <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/>
                            <line x1="1" y1="12" x2="3" y2="12"/>
                            <line x1="21" y1="12" x2="23" y2="12"/>
                            <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/>
                            <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/>
                        </svg>
                    </button>
                    <div class="theme-dropdown" id="themeDropdown">
                        <div class="theme-dropdown-header">테마 선택</div>
                        <button class="theme-option" data-theme="dark" onclick="setTheme('dark')">
                            <span class="theme-preview dark"></span>
                            <span>다크 모드</span>
                        </button>
                        <button class="theme-option" data-theme="light" onclick="setTheme('light')">
                            <span class="theme-preview light"></span>
                            <span>라이트 모드</span>
                        </button>
                        <button class="theme-option" data-theme="ocean" onclick="setTheme('ocean')">
                            <span class="theme-preview ocean"></span>
                            <span>오션 블루</span>
                        </button>
                        <button class="theme-option" data-theme="forest" onclick="setTheme('forest')">
                            <span class="theme-preview forest"></span>
                            <span>포레스트</span>
                        </button>
                        <button class="theme-option" data-theme="sunset" onclick="setTheme('sunset')">
                            <span class="theme-preview sunset"></span>
                            <span>선셋</span>
                        </button>
                        <button class="theme-option" data-theme="purple" onclick="setTheme('purple')">
                            <span class="theme-preview purple"></span>
                            <span>퍼플</span>
                        </button>
                    </div>
                </div>
                <div class="header-divider"></div>
                <button class="btn-secondary" onclick="resetView()">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/>
                        <path d="M3 3v5h5"/>
                    </svg>
                    뷰 초기화
                </button>
                <button class="btn-secondary" onclick="resetSampleData()" title="샘플 데이터 초기화">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/>
                        <path d="M3 3v5h5"/>
                        <path d="M3 12a9 9 0 0 0 9 9 9.75 9.75 0 0 0 6.74-2.74L21 16"/>
                        <path d="M21 21v-5h-5"/>
                    </svg>
                    데이터 초기화
                </button>
                <button class="btn-secondary" onclick="openAddRequestModal()">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="3" y="3" width="18" height="18" rx="2"/>
                        <line x1="12" y1="8" x2="12" y2="16"/>
                        <line x1="8" y1="12" x2="16" y2="12"/>
                    </svg>
                    신청서 추가
                </button>
                <button class="btn-primary" onclick="openAddMemberModal()">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
                        <circle cx="8.5" cy="7" r="4"/>
                        <line x1="20" y1="8" x2="20" y2="14"/>
                        <line x1="23" y1="11" x2="17" y2="11"/>
                    </svg>
                    담당자 추가
                </button>
            </div>
        </header>

        <!-- 메인 컨텐츠 -->
        <div class="graph-main">
            <!-- 좌측 패널 - 부서/팀 목록 -->
            <aside class="department-panel">
                <div class="panel-header">
                    <h3>부서 & 팀</h3>
                    <button class="btn-icon" onclick="toggleAllDepartments()">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M6 9l6 6 6-6"/>
                        </svg>
                    </button>
                </div>
                <div class="department-list" id="departmentList">
                    <!-- 부서 목록이 동적으로 렌더링됨 -->
                </div>
                <div class="panel-footer">
                    <div class="legend">
                        <div class="legend-item">
                            <span class="legend-dot status-pending"></span>
                            <span>대기</span>
                        </div>
                        <div class="legend-item">
                            <span class="legend-dot status-progress"></span>
                            <span>진행중</span>
                        </div>
                        <div class="legend-item">
                            <span class="legend-dot status-completed"></span>
                            <span>완료</span>
                        </div>
                    </div>
                </div>
            </aside>

            <!-- 그래프 캔버스 -->
            <div class="graph-canvas-container">
                <!-- 레이아웃 선택 탭 -->
                <div class="layout-tabs">
                    <div class="layout-tabs-label">레이아웃:</div>
                    <button class="layout-tab active" data-layout="none" onclick="selectLayout('none')">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="5" cy="5" r="2"/>
                            <circle cx="19" cy="5" r="2"/>
                            <circle cx="12" cy="12" r="2"/>
                            <circle cx="5" cy="19" r="2"/>
                            <circle cx="19" cy="19" r="2"/>
                        </svg>
                        <span>자유 배치</span>
                    </button>
                    <button class="layout-tab" data-layout="hierarchical" onclick="selectLayout('hierarchical')">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="9" y="2" width="6" height="4" rx="1"/>
                            <rect x="3" y="18" width="6" height="4" rx="1"/>
                            <rect x="15" y="18" width="6" height="4" rx="1"/>
                            <line x1="12" y1="6" x2="12" y2="12"/>
                            <line x1="6" y1="18" x2="6" y2="12"/>
                            <line x1="18" y1="18" x2="18" y2="12"/>
                            <line x1="6" y1="12" x2="18" y2="12"/>
                        </svg>
                        <span>계층형</span>
                    </button>
                    <button class="layout-tab" data-layout="circular" onclick="selectLayout('circular')">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="9"/>
                            <circle cx="12" cy="3" r="2"/>
                            <circle cx="21" cy="12" r="2"/>
                            <circle cx="12" cy="21" r="2"/>
                            <circle cx="3" cy="12" r="2"/>
                        </svg>
                        <span>원형</span>
                    </button>
                    <button class="layout-tab" data-layout="grid" onclick="selectLayout('grid')">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="3" y="3" width="7" height="7"/>
                            <rect x="14" y="3" width="7" height="7"/>
                            <rect x="3" y="14" width="7" height="7"/>
                            <rect x="14" y="14" width="7" height="7"/>
                        </svg>
                        <span>그리드</span>
                    </button>
                    <button class="layout-tab" data-layout="force" onclick="selectLayout('force')">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="6" cy="6" r="3"/>
                            <circle cx="18" cy="8" r="3"/>
                            <circle cx="8" cy="18" r="3"/>
                            <circle cx="17" cy="17" r="3"/>
                            <line x1="8.5" y1="7.5" x2="15.5" y2="6.5"/>
                            <line x1="7" y1="9" x2="7.5" y2="15"/>
                            <line x1="10.5" y1="17" x2="14" y2="16"/>
                        </svg>
                        <span>연결 기반</span>
                    </button>
                    <button class="layout-tab" data-layout="department" onclick="selectLayout('department')">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="5" r="3"/>
                            <circle cx="5" cy="19" r="3"/>
                            <circle cx="19" cy="19" r="3"/>
                            <path d="M12 8v4"/>
                            <path d="M8 16l4-4 4 4"/>
                        </svg>
                        <span>부서별</span>
                    </button>
                    <button class="layout-tab" data-layout="status" onclick="selectLayout('status')">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="3" y="3" width="5" height="18" rx="1"/>
                            <rect x="10" y="8" width="5" height="13" rx="1"/>
                            <rect x="17" y="13" width="5" height="8" rx="1"/>
                        </svg>
                        <span>상태별</span>
                    </button>
                </div>
                
                <div class="graph-toolbar">
                    <div class="zoom-controls">
                        <button class="btn-icon" onclick="zoomIn()" title="확대">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="11" cy="11" r="8"/>
                                <line x1="21" y1="21" x2="16.65" y2="16.65"/>
                                <line x1="11" y1="8" x2="11" y2="14"/>
                                <line x1="8" y1="11" x2="14" y2="11"/>
                            </svg>
                        </button>
                        <span class="zoom-level" id="zoomLevel">100%</span>
                        <button class="btn-icon" onclick="zoomOut()" title="축소">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="11" cy="11" r="8"/>
                                <line x1="21" y1="21" x2="16.65" y2="16.65"/>
                                <line x1="8" y1="11" x2="14" y2="11"/>
                            </svg>
                        </button>
                    </div>
                    <div class="filter-controls">
                        <select id="statusFilter" onchange="filterByStatus()">
                            <option value="all">모든 상태</option>
                            <option value="pending">대기</option>
                            <option value="progress">진행중</option>
                            <option value="completed">완료</option>
                        </select>
                        <select id="departmentFilter" onchange="filterByDepartment()">
                            <option value="all">모든 부서</option>
                        </select>
                    </div>
                </div>
                <div class="graph-canvas" id="graphCanvas">
                    <svg class="connections-layer" id="connectionsLayer"></svg>
                    <div class="nodes-layer" id="nodesLayer">
                        <!-- 노드들이 동적으로 렌더링됨 -->
                    </div>
                </div>
            </div>

            <!-- 우측 패널 - 상세 정보 -->
            <aside class="detail-panel" id="detailPanel">
                <div class="panel-header">
                    <h3>상세 정보</h3>
                    <button class="btn-icon" onclick="closeDetailPanel()">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="18" y1="6" x2="6" y2="18"/>
                            <line x1="6" y1="6" x2="18" y2="18"/>
                        </svg>
                    </button>
                </div>
                <div class="panel-body" id="detailContent">
                    <div class="empty-state">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                            <circle cx="12" cy="12" r="10"/>
                            <line x1="12" y1="16" x2="12" y2="12"/>
                            <line x1="12" y1="8" x2="12.01" y2="8"/>
                        </svg>
                        <p>노드를 선택하면<br>상세 정보가 표시됩니다</p>
                    </div>
                </div>
            </aside>
        </div>
    </div>

    <!-- 신청서 추가 모달 -->
    <div class="modal-overlay" id="addRequestModal">
        <div class="modal modal-md">
            <div class="modal-header">
                <h3>신청서 추가</h3>
                <button class="btn-icon" onclick="closeModal('addRequestModal')">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18"/>
                        <line x1="6" y1="6" x2="18" y2="18"/>
                    </svg>
                </button>
            </div>
            <div class="modal-body">
                <form id="addRequestForm">
                    <div class="form-group">
                        <label>신청서 제목</label>
                        <input type="text" id="requestTitle" placeholder="신청서 제목을 입력하세요" required>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>유형</label>
                            <select id="requestType" required>
                                <option value="">선택하세요</option>
                                <option value="데이터 추출">데이터 추출</option>
                                <option value="화면 개발">화면 개발</option>
                                <option value="API 개발">API 개발</option>
                                <option value="버그 수정">버그 수정</option>
                                <option value="인프라 요청">인프라 요청</option>
                                <option value="보안 점검">보안 점검</option>
                                <option value="기타">기타</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>우선순위</label>
                            <select id="requestPriority" required>
                                <option value="low">낮음</option>
                                <option value="medium" selected>보통</option>
                                <option value="high">높음</option>
                                <option value="urgent">긴급</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>요청 부서</label>
                        <select id="requestDepartment" required>
                            <option value="">선택하세요</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>설명</label>
                        <textarea id="requestDescription" rows="3" placeholder="신청서 설명을 입력하세요"></textarea>
                    </div>
                    <div class="form-group">
                        <label>마감일</label>
                        <input type="date" id="requestDeadline">
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" onclick="closeModal('addRequestModal')">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18"/>
                        <line x1="6" y1="6" x2="18" y2="18"/>
                    </svg>
                    취소
                </button>
                <button class="btn-primary" onclick="addRequest()">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="3" y="3" width="18" height="18" rx="2"/>
                        <line x1="12" y1="8" x2="12" y2="16"/>
                        <line x1="8" y1="12" x2="16" y2="12"/>
                    </svg>
                    신청서 추가
                </button>
            </div>
        </div>
    </div>

    <!-- 담당자 추가 모달 -->
    <div class="modal-overlay" id="addMemberModal">
        <div class="modal modal-md">
            <div class="modal-header">
                <h3>담당자 추가</h3>
                <button class="btn-icon" onclick="closeModal('addMemberModal')">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18"/>
                        <line x1="6" y1="6" x2="18" y2="18"/>
                    </svg>
                </button>
            </div>
            <div class="modal-body">
                <form id="addMemberForm">
                    <div class="form-group">
                        <label>이름</label>
                        <input type="text" id="memberName" placeholder="담당자 이름을 입력하세요" required>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>부서</label>
                            <select id="memberDepartment" required onchange="updateTeamOptions()">
                                <option value="">선택하세요</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>팀</label>
                            <select id="memberTeam" required>
                                <option value="">부서를 먼저 선택하세요</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>직급</label>
                        <select id="memberPosition" required>
                            <option value="사원">사원</option>
                            <option value="주임">주임</option>
                            <option value="대리">대리</option>
                            <option value="과장">과장</option>
                            <option value="차장">차장</option>
                            <option value="부장">부장</option>
                            <option value="팀장">팀장</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>이메일</label>
                        <input type="email" id="memberEmail" placeholder="이메일을 입력하세요">
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" onclick="closeModal('addMemberModal')">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18"/>
                        <line x1="6" y1="6" x2="18" y2="18"/>
                    </svg>
                    취소
                </button>
                <button class="btn-primary" onclick="addMember()">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
                        <circle cx="8.5" cy="7" r="4"/>
                        <line x1="20" y1="8" x2="20" y2="14"/>
                        <line x1="23" y1="11" x2="17" y2="11"/>
                    </svg>
                    담당자 추가
                </button>
            </div>
        </div>
    </div>

    <!-- 평가 모달 -->
    <div class="modal-overlay" id="evaluationModal">
        <div class="modal modal-lg">
            <div class="modal-header">
                <h3>업무 평가</h3>
                <button class="btn-icon" onclick="closeModal('evaluationModal')">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18"/>
                        <line x1="6" y1="6" x2="18" y2="18"/>
                    </svg>
                </button>
            </div>
            <div class="modal-body" id="evaluationContent">
                <!-- 평가 내용이 동적으로 렌더링됨 -->
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" onclick="closeModal('evaluationModal')">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18"/>
                        <line x1="6" y1="6" x2="18" y2="18"/>
                    </svg>
                    닫기
                </button>
                <button class="btn-primary" onclick="saveEvaluation()">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/>
                        <polyline points="17 21 17 13 7 13 7 21"/>
                        <polyline points="7 3 7 8 15 8"/>
                    </svg>
                    평가 저장
                </button>
            </div>
        </div>
    </div>

    <!-- 토스트 컨테이너 -->
    <div class="toast-container" id="toastContainer"></div>

    <script src="js/auth-check.js"></script>
    <script src="js/request-graph.js"></script>
</body>
</html>

